<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>[Project Name Here]</title>

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <style>
            /* Lookin' good */
        </style>

        <script src="../../node_modules/wetfish-basic/dist/basic.js"></script>

        <script>
            const data = {
                currentCustomers: 0,
                newCustomers: 0,
                churnRate: 0,
                customerRevenue: 0,
                month: 0,
                customersLost: 0,
                revenue: 0,
            };

            function getInput()
            {
                data.currentCustomers = parseInt($('[name="currentCustomers"]').value());
                data.newCustomers = parseInt($('[name="newCustomers"]').value());
                data.churnRate = parseInt($('[name="churnRate"]').value());
                data.customerRevenue = parseInt($('[name="customerRevenue"]').value());
            }

            function updateOutput()
            {
                $('.month').text(data.month.toString());
                $('.customers').text(data.currentCustomers.toString());
                $('.customersLost').text(data.customersLost.toString());
                $('.revenue').text(data.revenue.toString());
            }

            function createLogRow()
            {
                $('.output').append(`<div class='row'>Month #${data.month}, Active Customers: ${data.currentCustomers}, Monthly Revenue: ${data.revenue}</div>`);
            }

            function calculateRevenue()
            {
                data.revenue = data.currentCustomers * data.customerRevenue;
            }

            function calculateChurn()
            {
                // Every month we lose the churnRate percentage of our customers
                data.customersLost = Math.round(data.currentCustomers * (data.churnRate /  100));
                data.currentCustomers -= data.customersLost;

                // But we get more new customers every month!
                data.currentCustomers += data.newCustomers;
            }

            $(document).ready(function()
            {
                console.log("howdy");

                getInput();
                updateOutput();

                $('input').on('input change', function() {
                    getInput();
                    updateOutput();
                });

                $('.calculate').on('click', function() {
                    // If revenue is 0, we have to calculate it!
                    if(!data.revenue) {
                        calculateRevenue();
                        createLogRow();
                    }

                    data.month++;
                    calculateChurn();
                    calculateRevenue();
                    createLogRow();
                    updateOutput();
                });

                $('.autoCalculate').on('click', function() {

                });

                $('.reset').on('click', function() {
                    $('.output .row').remove();

                    data.currentCustomers = 0;
                    data.newCustomers = 0;
                    data.churnRate = 0;
                    data.customerRevenue = 0;
                    data.month = 0;
                    data.customersLost = 0;
                    data.revenue = 0;

                    getInput();
                    calculateRevenue();
                    updateOutput();
                    createLogRow();
                });
            });
        </script>
    </head>

    <body>
        <div>
            <input type="number" name="currentCustomers" value="10" /> Current Customers
        </div>

        <div>
            <input type="number" name="newCustomers" value="10" /> New Customers Per Month
        </div>

        <div>
            <input type="number" name="churnRate" value="10" /> Monthly Churn Rate (%)
        </div>

        <div>
            <input type="number" name="customerRevenue" value="100" /> Revenue Per Account
        </div>

        <h1>
            Current Month - <span class="month"></span>
        </h1>

        <h1>
            Current Customers - <span class="customers"></span>
        </h1>

        <h1>
            Customers Lost This Month - <span class="customersLost"></span>
        </h1>

        <h1>
            Revenue This Month - <span class="revenue"></span>
        </h1>

        <div>
            <button class="calculate">Calculate This Month</button>
            <button class="autoCalculate">Find Ceiling</button>
            <button class="reset">Reset</button>
        </div>

        <h1>History</h1>

        <div class="output"></div>
    </body>
</html>
